<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Cotejo</title>
        <meta name="description" content="">
        <meta name="author" content="Oxes">
        <meta name="HandheldFriendly" content="True">
        <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="format-detection" content="telephone=no">
        <meta http-equiv="cleartype" content="on">

        <!-- iPhone -->
        <link href="http://cdn.tapquo.com/lungo/icon-57.png" sizes="57x57" rel="apple-touch-icon">
        <link href="http://cdn.tapquo.com/lungo/startup-image-320x460.png" media="(device-width: 320px) and (device-height: 480px)
              and (-webkit-device-pixel-ratio: 1)" rel="apple-touch-startup-image">

        <!-- iPhone (Retina) -->
        <link href="http://cdn.tapquo.com/lungo/icon-114.png" sizes="114x114" rel="apple-touch-icon">
        <link href="http://cdn.tapquo.com/lungo/startup-image-640x920.png" media="(device-width: 320px) and (device-height: 480px)
              and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image">

        <!-- iPhone 5 -->
        <link href="http://cdn.tapquo.com/lungo/startup-image-640x1096.png" media="(device-width: 320px) and (device-height: 568px)
              and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image">

        <!-- iPad -->
        <link href="http://cdn.tapquo.com/lungo/icon-72.png" sizes="72x72" rel="apple-touch-icon">
        <link href="http://cdn.tapquo.com/lungo/startup-image-768x1004.png" media="(device-width: 768px) and (device-height: 1024px)
              and (orientation: portrait)
              and (-webkit-device-pixel-ratio: 1)" rel="apple-touch-startup-image">
        <link href="http://cdn.tapquo.com/lungo/startup-image-748x1024.png" media="(device-width: 768px) and (device-height: 1024px)
              and (orientation: landscape)
              and (-webkit-device-pixel-ratio: 1)" rel="apple-touch-startup-image">

        <!-- iPad (Retina) -->
        <link href="http://cdn.tapquo.com/lungo/icon-144.png" sizes="144x144" rel="apple-touch-icon">
        <link href="http://cdn.tapquo.com/lungo/startup-image-1536x2008.png" media="(device-width: 768px) and (device-height: 1024px)
              and (orientation: portrait)
              and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image">
        <link href="http://cdn.tapquo.com/lungo/startup-image-1496x2048.png" media="(device-width: 768px) and (device-height: 1024px)
              and (orientation: landscape)
              and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image">

        <!-- Main Stylesheet -->
        <link rel="stylesheet" href="components/lungo.css">
        <link rel="stylesheet" href="components/lungo.theme.css">
        <link rel="stylesheet" href="components/lungo.icon.css">
        <!-- App Stylesheet -->
        <link rel="stylesheet" href="static/stylesheets/app.css">
        <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    </head>

    <body>
        <section id="sec_login" data-transition="cover">
            <article id="main_article" class="indented splash">
                <div class="form">
                    <fieldset data-icon="user">
                        <input type="text" id="correo" placeholder="Correo"/>
                    </fieldset>
                    <fieldset data-icon="asterisk">
                        <input type="password" id="clave" placeholder="Clave"/>
                    </fieldset>
                    <a href="#" id="login" class="button anchor" data-icon="user" data-label="Ingresar"></a>
                    <a href="#" data-view-section="registrarUsuario" class="button anchor" data-icon="key" data-label="Registrarse"></a>
                </div>
            </article>
        </section>

        <section id="registrarUsuario" data-transition="cover">
            <header data-title="REGISTRO USUARIO" >
                <nav>
                    <a href="#" data-view-section="sec_login" 
                       data-icon="chevron-left"></a>
                </nav>
            </header>
            <article id="artRegistrarUsuario" class="indented splash">
                <div class="form">
                    <fieldset data-icon="user">
                        <input type="text" id="correoNuevo" placeholder="Correo"/>
                    </fieldset>
                    <fieldset data-icon="user">
                        <input type="text" id="nombreNuevo" placeholder="Nombre"/>
                    </fieldset>
                    <fieldset data-icon="user">
                        <input type="text" id="apellidoNuevo" placeholder="Apellidos"/>
                    </fieldset>
                    <fieldset data-icon="asterisk">
                        <input type="password" id="claveNuevo" placeholder="Clave"/>
                    </fieldset>
                    <fieldset data-icon="asterisk">
                        <input type="password" id="claveNuevoConfirmacion" placeholder="Confirma Clave"/>
                    </fieldset>
                    <a href="#" id="almacenar_usuario" class="button anchor" data-icon="user" data-label="Crear Usuario"></a>
                </div>
            </article>
        </section>

        <section id="main_section" data-transition="slide" data-aside="features" class="drag">
            <header>
                <nav>
                    <a href="#" data-view-aside="features" data-icon="menu"></a>
                </nav>
                <img src="static/images/logo.png" class="title centered"/>
                <nav class="on-right">
                    <!--<a href="#"  ><abbr class="text tiny ">v1.0</abbr></a> -->
                </nav>
            </header>

            <nav data-control="groupbar" data-article="icon-symbol icon-media icon-toolbar icon-social icon-item">
                <a href="#" data-view-article="icon-symbol" data-label="Symbol" data-async="static/articles/icon-symbol.html"></a>
                <a href="#" data-view-article="icon-media" data-label="Media" data-async="static/articles/icon-media.html"></a>
                <a href="#" data-view-article="icon-toolbar" data-label="Toolbar" data-async="static/articles/icon-toolbar.html"></a>
                <a href="#" data-view-article="icon-social" data-label="Social"  data-async="static/articles/icon-social.html"></a>
                <a href="#" data-view-article="icon-item" data-label="Item" data-async="static/articles/icon-item.html"></a>
            </nav>
            <nav data-control="groupbar" data-article="mi-equipo rival cancha">
                <a href="#" data-view-article="mi-equipo" data-icon="checkmark" data-label="Mi Equipo"></a>
                <a href="#" data-view-article="rival" data-label="Rival"></a>
                <a href="#" data-view-article="cancha" data-label="Cancha"></a>
            </nav>

            <nav data-control="groupbar" data-article="juego-en mis-quipos">
                <a href="#" data-view-article="juego-en" data-icon="checkmark" data-label="Juego En"></a>
                <a href="#" data-view-article="mis-quipos" data-label="Mis Equipos"></a>
            </nav>			

            <article id="main-article" class="list indenteds scroll">
                <ul>
                    <li class="text small">
                        Noticias de Cotejos creados p√∫blicos y Eventos
                    </li>
                </ul>
            </article>
        </section>

        <!-- Lungo dependencies -->
        <script src="components/quo.js"></script>
        <script src="components/lungo.js"></script>
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/index.js"></script>	
        <!-- LungoJS - Sandbox App -->
        <script>
            Lungo.init({
                name: 'Cotejo',
                version: '1.0',
                resources: [
                    'static/asides/features.html',
                    'static/asides/right.html',
                    'static/sections/form.html'],
                history: false
            });

            Lungo.ready(function () {
                var servicio = "http://oxes-cotejo.rhcloud.com/webresources/generic/";
                //var servicio = "http://10.1.244.33:8081/webresources/generic/";
                var usuario = {
                    nombre: null, clave: null, claveConfirmacion: null, correo: null, edad: 0, listaGoles: null, apellido: null
                };
                if (sessionStorage.getItem("correo"))
                {
                    Lungo.Router.section("main_section");
                }
                else
                {
                    $$("#login").on("tap", function () {

                        var url = servicio + "post/validarUsuario";
                        usuario.correo = $$("#correo").val();
                        usuario.clave = $$("#clave").val();

                        $.ajax({
                            url: url,
                            type: 'POST',
                            data: JSON.stringify(usuario),
                            dataType: 'json',
                            contentType: 'application/json',
                            success: function (resp) {
                                Lungo.Router.section("main_section");
                                sessionStorage["codigo"] = resp.codigo;
                                sessionStorage["correo"] = resp.correo;
                                sessionStorage["nombre"] = resp.nombre;
                                sessionStorage["apellido"] = resp.apellido;
                                $$("#login_correo").html(sessionStorage.getItem("correo"));
                                $$("#login_nombre").html(sessionStorage.getItem("nombre") + ' ' + sessionStorage.getItem("apellido"));
                            },
                            error: function (e) {
                                var html = $.parseHTML(e.responseText)
                                var mensaje = message(html);
                                if (mensaje == null) {
                                    alert('Error al crear el usuario, contacte a soporte');
                                } else {
                                    alert(mensaje);
                                }
                            }
                        });
                    });
                }
                $$("#logout").on("tap", function () {
                    sessionStorage.clear();
                    Lungo.Router.section("sec_login");
                });
                $$("#almacenar_usuario").on("tap", function () {

                    var url = servicio + "post/usuario";
                    usuario.correo = $$("#correoNuevo").val();
                    usuario.nombre = $$("#nombreNuevo").val();
                    usuario.apellido = $$("#apellidoNuevo").val();
                    usuario.clave = $$("#claveNuevo").val();
                    usuario.claveConfirmacion = $$("#claveNuevoConfirmacion").val();

                    $.ajax({
                        url: url,
                        type: 'POST',
                        data: JSON.stringify(usuario),
                        dataType: 'json',
                        contentType: 'application/json',
                        success: function (resp) {
                            Lungo.Router.section("sec_login");
                            alert('Usuario creado correctamente.');
                        },
                        error: function (e) {
                            var html = $.parseHTML(e.responseText)
                            var mensaje = message(html);
                            if (mensaje == null) {
                                alert('Error al crear el usuario, contacte a soporte');
                            } else {
                                alert(mensaje);
                            }
                        }
                    });
                });
                $$("#actualizar_usuario").on("tap", function () {
                    var url = servicio + "patch/usuario";
                    usuario.correo = $$("#correoNuevo").val();
                    usuario.nombre = $$("#nombreNuevo").val();
                    usuario.apellido = $$("#apellidoNuevo").val();
                    usuario.clave = $$("#claveNuevo").val();
                    usuario.claveConfirmacion = $$("#claveNuevoConfirmacion").val();
                });
            });

            function message(html) {
                for (var i = 0; i < html.length; i++) {
                    if (html[i].innerHTML != null && html[i].innerHTML.indexOf('java.lang') !== -1) {
                        return html[i].innerHTML.split(":")[1];
                    }
                }
            }

            function cargarDatosUsuarioActualizar() {
                $$("#correo_actualizar").val(sessionStorage.getItem("correo"));
                $$("#nombre_actualizar").val(sessionStorage.getItem("nombre"));
                $$("#apellido_actualizar").val(sessionStorage.getItem("apellido"));
                $$("#clave_actualizar").val('clave');
            }

        </script>
        <script src="static/javascripts/app.js"></script>
    </body>
</html>
